# Configuration for systemd-swap
# This file is part of systemd-swap.
# See swap.conf(5) for details.
#
# Values commented with ## are auto-detected based on hardware.
# Uncomment to override with custom values.

################################################################################
# Swap Mode
#
# auto            - Auto-detect best mode (default, recommended)
#                   - btrfs/ext4/xfs -> zswap + swapfc
#                   - others -> zram only
# zswap+swapfc    - Zswap + swap files (best for desktop/btrfs)
# zram+swapfc     - Zram + swap files (good for low RAM)
# zram            - Zram only (no disk swap)
# manual          - Use explicit settings below
################################################################################

swap_mode=auto

################################################################################
# Zswap Settings (used in zswap+swapfc mode)
#
# Zswap compresses pages in RAM before writing to swap disk.
# With ~3x compression ratio, 8GB RAM + 50% pool = ~12GB effective swap in RAM.
# The kernel auto-manages when to writeback cold pages to disk.
################################################################################

## zswap_compressor=zstd           # Compression: lz4 (fastest), zstd (balanced), lzo
## zswap_max_pool_percent=50       # Max RAM % for compressed pool
## zswap_zpool=zsmalloc            # Allocator (zsmalloc is the only option in modern kernels)
## zswap_shrinker_enabled=1        # Proactively move cold pages to disk
## zswap_accept_threshold=85       # Resume accepting pages when pool drops to X%

################################################################################
# Zram Settings (used in zram modes)
#
# Zram creates a compressed block device in RAM.
# Unlike zswap, size is virtual (uncompressed) size, not RAM usage limit.
################################################################################

## zram_size=80%                   # Virtual size (e.g., 80%, 1G)
## zram_alg=lz4                    # Compression: lz4 (fast), zstd (better ratio)
## zram_mem_limit=70%              # Max physical RAM zram can use (OOM protection)
## zram_prio=32767                 # Priority (max = 32767)

# Zram Writeback (optional, off by default)
# Moves incompressible/idle pages to backing storage
## zram_writeback=0
## zram_writeback_size=1G          # Initial backing file size
## zram_writeback_max_size=8G      # Max size
## zram_writeback_threshold=50     # Trigger when zram is X% full

################################################################################
# SwapFC - Dynamic Swap Files (used in swapfc modes)
#
# Progressive scaling: starts with base size, doubles every N files.
# With 32 files max and step=3: 1G -> 1G -> 1G -> 2G -> 2G -> 2G -> 4G...
# Total capacity can reach hundreds of GB while using minimal disk initially.
################################################################################

swapfc_enabled=1
swapfc_path=/swapfc/swapfile

# Size configuration (auto-detected based on RAM if commented)
## swapfc_chunk_size=512M          # Base chunk size (minimum 512M recommended)
## swapfc_max_chunk_size=64G       # Max single file size
## swapfc_max_count=32             # Max files (kernel limit is 32)
## swapfc_scaling_step=3           # Double size every X files

# Triggers (auto-tuned if commented)
## swapfc_free_ram_perc=20         # Create swap when free RAM < X%
## swapfc_free_swap_perc=40        # Create more when free swap < X%
## swapfc_remove_free_swap_perc=70 # Remove files when free swap > X%

################################################################################
# MGLRU Anti-Thrashing (Kernel 6.1+)
#
# Protects working set from premature eviction.
# Auto-adjusted based on RAM: 1-2GB: 10s, 2-4GB: 5s, 4-8GB: 3s, 16GB+: 1s
################################################################################

## mglru_min_ttl_ms=auto           # Set to 0 to disable

################################################################################
# Sparse Files
#
# Sparse files only use disk space when actually written to.
# Enabled by default in zswap mode (disk space used only on writeback).
# Pre-allocated files may have slight performance benefit but use more disk.
################################################################################

## swapfc_use_sparse_disable=1     # Uncomment to force pre-allocation
