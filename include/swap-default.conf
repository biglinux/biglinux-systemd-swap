# Configuration for systemd-swap
# This file is part of systemd-swap.
# See swap.conf(5) for details.
#
# Values commented with ## are auto-detected based on hardware.
# Uncomment to override with custom values.

################################################################################
# Swap Mode
#
# auto            - Auto-detect best mode (default, recommended)
#                   - btrfs/ext4/xfs with enough disk → zram + swapfiles
#                   - LiveCD or no disk support → zram only
# zram+swapfile   - Zram + swap files (zram primary, swapfiles for overflow)
# zswap+swapfile  - Zswap + swap files (zswap compresses in kernel, writes back to disk)
# zram            - Zram only (no disk swap — LiveCD, low disk)
# manual          - Use explicit flags (zram_enabled, zswap_enabled, swapfc_enabled)
# disabled        - Disable swap management (service exits cleanly)
################################################################################

swap_mode=auto

################################################################################
# Zram Settings (used in zram and zram+swapfile modes)
#
# Zram creates compressed block devices in RAM. Size is virtual
# (uncompressed); actual RAM usage depends on compression ratio.
# At ~3.4x ratio with zstd, 150% disksize uses ~45% RAM when full.
#
# The daemon manages a dynamic pool of zram devices:
#   - Starts with 4 devices (= CPU count, max 8)
#   - Expands when utilization > 85%
#   - Contracts when utilization < 20% for 120s
################################################################################

## zram_size=150%                  # Virtual disksize (% of RAM). Larger = more data in RAM
## zram_alg=zstd                   # Compression: zstd (best ratio), lz4 (fastest), lzo
## zram_mem_limit=0%               # 0 = no limit (recommended). disksize controls capacity
## zram_prio=32767                 # Swap priority (max = 32767, higher = preferred)

# Zram Pool Tuning (advanced)
## zram_expand_threshold=85        # Expand pool when utilization > this %
## zram_contract_threshold=20      # Contract pool when utilization < this %
## zram_expand_cooldown=10         # Seconds between expansions
## zram_contract_stability=120     # Seconds of low usage before contraction
## zram_min_free_ram=15            # Don't expand if free RAM < this %
## zram_check_interval=5           # Monitor interval in seconds

################################################################################
# Zswap Settings (used in zswap+swapfile mode)
#
# Zswap compresses pages in the kernel before writing to disk swap.
# With ~3x ratio, 8GB RAM + 45% pool = ~10.8GB effective swap in RAM.
# The shrinker writes cold pages to disk automatically.
################################################################################

## zswap_compressor=zstd           # Compression: lz4 (fastest), zstd (balanced), lzo
## zswap_zpool=zsmalloc            # Memory allocator (zsmalloc recommended)
## zswap_max_pool_percent=45       # Max RAM % for compressed pool
## zswap_shrinker_enabled=1        # Move cold pages to disk when pool is full
## zswap_accept_threshold=80       # Resume accepting pages when pool drops to this %

################################################################################
# SwapFile - Dynamic Swap Files (overflow for zram/zswap)
#
# Creates swap files on demand when memory pressure is high.
# Files are pre-allocated with NOCOW on btrfs for safety.
# Priority is lower than zram: kernel only uses them when zram is full.
################################################################################

## swapfile_path=/swapfile         # Base path for swap files
## swapfile_chunk_size=512M        # Size of each swap file
## swapfile_max_count=28           # Maximum number of swap files
## swapfile_free_ram_perc=20       # Create swap file when free RAM < this %
## swapfile_free_swap_perc=40      # Create swap file when free swap < this %
## swapfile_remove_free_swap_perc=70 # Remove swap file when free swap > this %

## swapfile_discard=none           # Discard policy: none (safest), auto, once
## swapfile_nocow=1                # NOCOW (chattr +C) on btrfs (prevents deadlock)

## swapfile_btrfs_compress=        # Btrfs compression (only when nocow=0 + sparse_loop=1)
                                   # Options: zstd, lzo, zlib, none

################################################################################
# Loop Device Tuning (used in loop-backed swap modes)
################################################################################

## swapfile_loop_scheduler=auto    # I/O scheduler: auto, kyber, bfq, mq-deadline, none
## swapfile_loop_backing_fs=auto   # Backing filesystem: auto (host fs), f2fs

