# Configuration for systemd-swap
# This file is part of systemd-swap.
# See swap.conf(5) for details.

################################################################################
# Swap Mode
#
# auto            - Auto-detect best mode (default)
#                   - btrfs/ext4/xfs -> zswap + swapfc
#                   - others -> zram only
# zswap+swapfc    - Zswap + swap files (best for desktop/btrfs)
# zram+swapfc     - Zram + swap files (good for low RAM)
# zram            - Zram only (no disk swap)
# manual          - Use explicit settings below
################################################################################

swap_mode=auto

################################################################################
# Zswap Settings (used in zswap+swapfc mode)
################################################################################

zswap_compressor=zstd            # Compression algo: zstd, lz4, lzo
zswap_max_pool_percent=60        # Max RAM for compressed pool
zswap_zpool=zsmalloc             # Allocator
zswap_shrinker_enabled=1         # Proactively move cold pages to disk
zswap_accept_threshold=90        # Restart accepting pages when pool drops to X%

################################################################################
# Zram Settings (used in zram modes)
################################################################################

zram_size=80%                    # Size of zram device (e.g., 50%, 1G)
zram_alg=zstd                    # Compression algo
zram_prio=32767                  # Priority (highest)

# Zram Writeback (optional, off by default)
# Moves incompressible/idle pages to backing storage
zram_writeback=0
zram_writeback_size=1G           # Initial backing file size
zram_writeback_max_size=8G       # Max size
zram_writeback_threshold=50      # Trigger when zram is X% full

################################################################################
# SwapFC - Dynamic Swap Files (used in swapfc modes)
################################################################################

# Progressive Scaling: Start small, grow as needed
# e.g. 256M -> 256M -> 512M -> 512M... doubles every 4 files
swapfc_enabled=1                 # Enable swap files
swapfc_path=/swapfc/swapfile     # Directory and filename prefix
swapfc_chunk_size=256M           # Base size
swapfc_max_chunk_size=32G        # Max single file size
swapfc_max_count=28              # Max number of files
swapfc_scaling_step=4            # Double size every X files

# Triggers
swapfc_free_ram_perc=35          # Create swap when free RAM < X%
swapfc_free_swap_perc=25         # Create more when free swap < X%
swapfc_remove_free_swap_perc=55  # Remove files when free swap > X%

################################################################################
# Advanced / Experimental
################################################################################

# MGLRU Anti-Thrashing (Kernel 6.1+)
# Protect working set for X ms. 0 to disable.
mglru_min_ttl_ms=1000

# Sparse Files
# Create files that only use disk space when actually written to.
# Highly recommended for Zswap mode.
# swapfc_use_sparse_disable=1    # Uncomment to disable (pre-allocate all space)
